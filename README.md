# 旅行費用精算アプリケーション

友人との旅行時に発生した費用を記録し、参加者間で公平に精算するためのWebアプリケーションです。

## 主な機能

### 基本機能
- **参加者管理**：旅行参加者の追加・編集・削除
- **支払い記録管理**：誰がいつ何にいくら支払ったかを記録
- **自動精算**：支払い記録を基に各参加者の負担額を自動計算
- **最適化された精算指示**：最小限の送金回数で精算できる指示を生成

### 拡張機能
- **複数通貨対応**：海外旅行での異なる通貨での支払いに対応
- **リアルタイム為替レート**：ExchangeRate-APIを使用した自動為替換算
- **データ永続化**：ブラウザのローカルストレージに自動保存

## 技術仕様

- **フレームワーク**: Next.js 14 (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **状態管理**: Zustand
- **フォーム管理**: React Hook Form
- **バリデーション**: Zod
- **コンテナ**: Docker

## 🚀 クイックスタート

### Docker環境

```bash
# パッケージのインストール&開発サーバー起動
npm run docker:dev

# ブラウザで http://localhost:3000 にアクセス
```

### ローカル環境

#### 前提条件
- Node.js 20以上

#### 環境構築

```bash
# パッケージのインストール
npm install

# 開発サーバー起動
npm run dev

# ブラウザで http://localhost:3000 にアクセス
```

## 使い方

### 1. 参加者の登録
- 「参加者」タブで旅行に参加する人の名前を入力して追加
- 同じ名前の場合は自動的に番号が付与されます

### 2. 支払いの記録
- 「支払い」タブで各支払いを記録
- 支払者、金額、通貨、説明、日時を入力
- 海外旅行の場合は適切な通貨を選択

### 3. 精算の確認
- 「精算」タブで各参加者の負担状況を確認
- 誰が誰にいくら支払えばよいかの指示を確認

### 4. 通貨設定
- 「設定」タブで基準通貨の設定
- 為替レートの確認と更新

## 機能詳細

### 精算計算アルゴリズム
1. 全支払いを基準通貨に換算
2. 総額を参加者数で割って一人当たりの負担額を算出
3. 各参加者の支払い済み額と負担額の差を計算
4. 最小限の送金回数となるよう最適化したペアリングを生成

### 為替レート取得
- ExchangeRate-API (https://api.exchangerate-api.com) をメインに使用
- 1時間ごとに自動更新
- オフライン時は最後に取得したレートを使用

## プロジェクト構造

```
src/
├── app/                 # Next.js App Router
├── components/          # Reactコンポーネント
│   ├── participants/    # 参加者管理関連
│   ├── expenses/        # 支払い記録関連
│   ├── settlement/      # 精算関連
│   └── common/          # 共通コンポーネント
├── hooks/               # カスタムフック
├── utils/               # ユーティリティ関数
├── types/               # 型定義
├── constants/           # 定数
└── store/               # 状態管理
```

## 注意事項

- データはブラウザのローカルストレージに保存されます
- ブラウザのデータをクリアするとデータが失われる可能性があります
- 為替レートはリアルタイムですが、正確性を保証するものではありません
- インターネット接続が必要な場合がありますが、オフラインでも最後に取得したレートで動作します

## 実装の工夫点

### 🔧 技術的工夫

#### 1. **最適化された精算アルゴリズム**
```typescript
// 最小限の送金回数を実現するグリーディアルゴリズム
export function calculateSettlements(participants, balances, baseCurrency) {
  const creditors = balances.filter(b => b.balance > 0.01);
  const debtors = balances.filter(b => b.balance < -0.01);
  // 債権者と債務者を金額順にソートし、最適ペアリング
}
```

- **問題**: N人の参加者で最大N-1回の送金が必要
- **解決策**: 債権・債務のマッチング最適化
- **効果**: 送金回数を最小限に抑制

### 🎨 UX/UI工夫

#### 2. **モバイルファーストな設計**
```css
/* レスポンシブデザインの実装例 */
.grid {
  @apply grid-cols-1 md:grid-cols-2 lg:grid-cols-3;
}

/* モバイル専用ボトムナビゲーション */
.fixed.bottom-0.sm:hidden
```

- **工夫**: Tailwind CSSによるレスポンシブクラス活用
- **効果**: 全デバイスで最適な操作性を提供

#### 3. **リアルタイム状態管理**
```typescript
// Zustandによる軽量状態管理
export const useStore = create<AppStore>()(
  persist(
    (set) => ({
      addExpense: (expense) => 
        set((state) => ({ expenses: [...state.expenses, expense] })),
      // 自動保存と即座のUI更新
    }),
    { name: 'travel-expense-storage' }
  )
);
```

- **工夫**: Zustand + persistミドルウェアによる自動永続化
- **効果**: データロスなしでシームレスな体験